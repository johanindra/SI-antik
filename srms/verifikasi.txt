<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Verifikasi Kode OTP - SI-antik</title>
</head>

<body>
    <div class="container">
        <div class="box">
            <!-- Kotak Verifikasi Kode OTP -->
            <div class="box-verification" id="verification">
                <div class="top-header">
                    <h3>Verifikasi Kode OTP</h3>
                </div>
                <!-- Tambahkan tombol Kirim -->
                <button class="input-submit" onclick="showOTPInput()" id="sendButton">Kirim</button>
                <!-- Formulir verifikasi yang awalnya tersembunyi -->
                <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="POST" id="otpForm" style="display: none;">
                    <div class="input-group">
                        <div class="input-field">
                            <input type="text" class="input-box" id="kode_otp" name="kode_otp" required />
                            <label for="kode_otp">Masukkan Kode OTP</label>
                        </div>
                        <div class="input-field-bt">
                            <button type="submit" class="input-submit">Verifikasi</button>
                        </div>
                        <div class="back-to-login">
                            <a href="index.php">Kembali ke Halaman Login</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function showOTPInput() {
            // Sembunyikan tombol "Kirim"
            document.getElementById("sendButton").style.display = "none";
            // Tampilkan formulir verifikasi OTP
            document.getElementById("otpForm").style.display = "block";
        }
    </script>
</body>

</html>

<?php
// Sisipkan file koneksi.php untuk menghubungkan ke database
include("../server/koneksi.php");

// Ambil nilai yang dimasukkan oleh pengguna
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $nik = $_POST["kodeOTP"];

    // Query SQL untuk memeriksa apakah NIK terdaftar di tabel admin
    $queryAdmin = "SELECT * FROM admin WHERE nik = :nik";
    $stmtAdmin = $dbh->prepare($queryAdmin);
    $stmtAdmin->bindParam(':nik', $nik, PDO::PARAM_STR);
    $stmtAdmin->execute();

    if ($stmtAdmin->rowCount() > 0) {
        // Jika NIK terdaftar di tabel admin
        // Redirect ke lupa-password.php tanpa parameter
        header("Location: lupa-password.php");
        exit();
    } else {
        // Jika NIK tidak terdaftar di tabel admin
        $errorMessage = "NIK tidak terdaftar!";

        // Tampilkan pesan kesalahan
        echo '<script>';
        echo 'alert("' . $errorMessage . '");';
        echo 'window.location.href = "verifikasi-nik.php";';
        echo '</script>';
    }
}
?>